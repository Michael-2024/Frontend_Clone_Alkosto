
> alkosto-clone-frontend@1.0.0 test
> react-scripts test RF01_Integration.test.js --watchAll=false

FAIL src/__tests__/RF01_Integration.test.js
  RF01 - REGISTRAR USUARIO - Pruebas de IntegraciÃ³n
    1. IntegraciÃ³n User Model â†” UserController
      âœ“ 1.1 Crear usuario a travÃ©s del controlador persiste en modelo correcto (3 ms)
      âœ“ 1.2 MÃºltiples usuarios registrados mantienen independencia (2 ms)
      âœ“ 1.3 Usuario registrado puede hacer login posteriormente (1 ms)
    2. IntegraciÃ³n UserController â†” localStorage
      âœ“ 2.1 Usuario registrado se guarda en localStorage con estructura correcta (2 ms)
      âœ“ 2.2 Cerrar sesiÃ³n elimina usuario actual pero mantiene lista (2 ms)
      âœ“ 2.3 Recargar pÃ¡gina recupera usuario desde localStorage
      âœ“ 2.4 Datos de usuario incluyen timestamps y metadatos (2 ms)
    3. IntegraciÃ³n con Sistema de VerificaciÃ³n (RF04)
      âœ“ 3.1 Usuario registrado inicia con estado "pendiente" (1 ms)
      âœ“ 3.2 Verificar email cambia estado a "validado" (1 ms)
      âœ“ 3.3 Verificar telÃ©fono cambia estado a "validado" (1 ms)
      âœ“ 3.4 Obtener estado de verificaciÃ³n de usuario (1 ms)
    4. ValidaciÃ³n de Emails Duplicados
      âœ“ 4.1 isEmailRegistered detecta email ya existente
      âœ“ 4.2 isEmailRegistered distingue mayÃºsculas (case-sensitive)
      âœ“ 4.3 MÃºltiples usuarios con diferentes emails
    5. IntegraciÃ³n con Sistema de Favoritos
      âœ“ 5.1 Usuario registrado puede agregar favoritos
      âœ“ 5.2 Eliminar favorito funciona correctamente
      âœ• 5.3 Favoritos son Ãºnicos por usuario (4 ms)
      âœ“ 5.4 syncPendingFavorite aplica favorito pendiente al registrarse
    6. IntegraciÃ³n con RecuperaciÃ³n de ContraseÃ±a
      âœ“ 6.1 resetPassword actualiza contraseÃ±a de usuario registrado (1 ms)
      âœ“ 6.2 getUserByEmail encuentra usuario registrado
      âœ“ 6.3 getUserByEmail retorna undefined para email no registrado
      âœ“ 6.4 verifyResetCode valida cÃ³digo correcto
      âœ“ 6.5 verifyResetCode rechaza cÃ³digo incorrecto
    7. Sistema de NotificaciÃ³n de Cambios
      âœ“ 7.1 addAuthListener registra callback correctamente (1 ms)
      âœ“ 7.2 notifyAuthChange llama a todos los listeners
      âœ“ 7.3 Registro dispara notificaciÃ³n de cambio de auth (1 ms)
      âœ“ 7.4 Logout dispara notificaciÃ³n de cambio de auth
      âœ“ 7.5 Unsubscribe elimina listener (1 ms)
    8. Flujo Completo End-to-End (IntegraciÃ³n Total)
      âœ“ 8.1 Flujo completo: Registro â†’ Login â†’ Favoritos â†’ Logout (1 ms)
      âœ“ 8.2 Flujo completo: Registro â†’ VerificaciÃ³n Email â†’ Estado Validado
      âœ“ 8.3 Flujo completo: Registro â†’ Recuperar ContraseÃ±a â†’ Login (3 ms)
    9. Casos Edge y Manejo de Errores
      âœ• 9.1 localStorage corrupto no rompe la aplicaciÃ³n (18 ms)
      âœ“ 9.2 Registrar con datos mÃ­nimos requeridos (1 ms)
      âœ“ 9.3 Cerrar sesiÃ³n sin usuario logueado
      âœ“ 9.4 Agregar favorito sin usuario logueado no causa error
      âœ“ 9.5 Verificar email de usuario no existente

  â— RF01 - REGISTRAR USUARIO - Pruebas de IntegraciÃ³n â€º 5. IntegraciÃ³n con Sistema de Favoritos â€º 5.3 Favoritos son Ãºnicos por usuario

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 2

      Array [
        100,
        200,
    +   300,
    +   400,
      ]

    [0m [90m 476 |[39m       [36mconst[39m fav2 [33m=[39m [33mUserController[39m[33m.[39mgetFavorites(user2[33m.[39mid)[33m;[39m
     [90m 477 |[39m
    [31m[1m>[22m[39m[90m 478 |[39m       expect(fav1)[33m.[39mtoEqual([[35m100[39m[33m,[39m [35m200[39m])[33m;[39m
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 479 |[39m       expect(fav2)[33m.[39mtoEqual([[35m300[39m[33m,[39m [35m400[39m])[33m;[39m
     [90m 480 |[39m     })[33m;[39m
     [90m 481 |[39m[0m

      at Object.<anonymous> (src/__tests__/RF01_Integration.test.js:478:20)
      at TestScheduler.scheduleTests (node_modules/@jest/core/build/TestScheduler.js:333:13)
      at runJest (node_modules/@jest/core/build/runJest.js:404:19)
      at _run10000 (node_modules/@jest/core/build/cli/index.js:320:7)
      at runCLI (node_modules/@jest/core/build/cli/index.js:173:3)

  â— RF01 - REGISTRAR USUARIO - Pruebas de IntegraciÃ³n â€º 9. Casos Edge y Manejo de Errores â€º 9.1 localStorage corrupto no rompe la aplicaciÃ³n

    expect(received).not.toThrow()

    Error name:    "SyntaxError"
    Error message: "Unexpected token 'i', \"invalid json {]\" is not valid JSON"

        [0m [90m 128 |[39m     [36mconst[39m usersJSON [33m=[39m localStorage[33m.[39mgetItem([36mthis[39m[33m.[39m[33mUSERS_KEY[39m)[33m;[39m
         [90m 129 |[39m     [36mif[39m (usersJSON) {
        [31m[1m>[22m[39m[90m 130 |[39m       [36mreturn[39m [33mJSON[39m[33m.[39mparse(usersJSON)[33m;[39m
         [90m     |[39m                   [31m[1m^[22m[39m
         [90m 131 |[39m     }
         [90m 132 |[39m     [36mreturn[39m [][33m;[39m
         [90m 133 |[39m   }[0m

      at UserController.getAllUsers (src/controllers/UserController.js:130:19)
      at src/__tests__/RF01_Integration.test.js:776:24
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:83:11)
      at Object.toThrow (node_modules/expect/build/index.js:382:21)
      at Object.<anonymous> (src/__tests__/RF01_Integration.test.js:777:14)
      at TestScheduler.scheduleTests (node_modules/@jest/core/build/TestScheduler.js:333:13)
      at runJest (node_modules/@jest/core/build/runJest.js:404:19)
      at _run10000 (node_modules/@jest/core/build/cli/index.js:320:7)
      at runCLI (node_modules/@jest/core/build/cli/index.js:173:3)
      at Object.<anonymous> (src/__tests__/RF01_Integration.test.js:777:14)
      at TestScheduler.scheduleTests (node_modules/@jest/core/build/TestScheduler.js:333:13)
      at runJest (node_modules/@jest/core/build/runJest.js:404:19)
      at _run10000 (node_modules/@jest/core/build/cli/index.js:320:7)
      at runCLI (node_modules/@jest/core/build/cli/index.js:173:3)

Test Suites: 1 failed, 1 total
Tests:       2 failed, 34 passed, 36 total
Snapshots:   0 total
Time:        1.186 s
Ran all test suites matching /RF01_Integration.test.js/i.
