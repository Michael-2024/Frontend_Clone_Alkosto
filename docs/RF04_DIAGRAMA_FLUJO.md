# ๐ Diagrama de Flujo RF04 - Verificaciรณn

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    FLUJO DE VERIFICACIรN RF04                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

    [Usuario]
       โ
       โโโโบ Navega a /register
       โ
       โโโโบ Ingresa email
       โ
       โโโโบ Completa datos (nombre, apellido, telรฉfono)
       โ
       โโโโบ Crea contraseรฑa
       โ
       v
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  UserController.registerUser()               โ
โ  - Crea usuario en localStorage              โ
โ  - Estado: estadoCuenta = 'pendiente'        โ
โ  - emailVerified = false                     โ
โ  - phoneVerified = false                     โ
โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
               โ
               โ navigate('/verify', { email, phone, fromRegister })
               v
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ             /verify - Pantalla de Selecciรณn                      โ
โ                                                                  โ
โ  [Verificaciรณn de cuenta]                                       โ
โ                                                                  โ
โ  Usuario: prueba@test.com                                       โ
โ  Telรฉfono: 3001234567                                           โ
โ                                                                  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ             โ
โ  โ  โ๏ธ Verificar por correo                      โ             โ
โ  โ  Recibe un cรณdigo en tu email                 โ             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ             โ
โ                                                                  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ             โ
โ  โ  ๐ฑ Verificar por SMS                         โ             โ
โ  โ  Recibe un cรณdigo en tu telรฉfono              โ             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ             โ
โ                                                                  โ
โ  [Verificar mรกs tarde]                                          โ
โโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
          โ                           โ
          โ Clic Email                โ Clic SMS
          v                           v
โโโโโโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ VerificationService     โ  โ VerificationService     โ
โ .enviarCorreo           โ  โ .enviarSMS              โ
โ Verificacion()          โ  โ ()                      โ
โ                         โ  โ                         โ
โ - Genera cรณdigo: 543210 โ  โ - Genera cรณdigo: 789012 โ
โ - Guarda en localStorageโ  โ - Guarda en localStorageโ
โ - Expira en 10 min      โ  โ - Expira en 10 min      โ
โโโโโโโโโโฌโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโฌโโโโโโโโโโโโโโโ
         โ                              โ
         โโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
                    โ
                    v
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ             /verify - Pantalla de Cรณdigo                         โ
โ                                                                  โ
โ  [Verificaciรณn de cรณdigo]                                       โ
โ                                                                  โ
โ  Ingresa el cรณdigo de 6 dรญgitos que enviamos a:                โ
โ  prueba@test.com                                                โ
โ                                                                  โ
โ  ๐ง Cรณdigo de desarrollo: 543210                                โ
โ  (En producciรณn, esto se enviarรญa por email/SMS)               โ
โ                                                                  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                         โ
โ  โ  Cรณdigo: [5][4][3][2][1][0]      โ                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                         โ
โ                                                                  โ
โ  [Verificar cรณdigo]                                             โ
โ                                                                  โ
โ  [Reenviar cรณdigo] [Cambiar mรฉtodo]                            โ
โโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
          โ
          โ Usuario ingresa cรณdigo
          v
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  VerificationService                     โ
โ  .validarConfirmacion()                  โ
โ                                          โ
โ  ยฟCรณdigo correcto?                       โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโ
       โ                 โ
       โ Sร              โ NO
       v                 v
โโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ UserController   โ  โ Error                     โ
โ .verifyEmail()   โ  โ "Cรณdigo incorrecto"       โ
โ o                โ  โ                           โ
โ .verifyPhone()   โ  โ [Reintentar]              โ
โ                  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Actualiza:       โ
โ emailVerified    โ
โ o phoneVerified  โ
โ = true           โ
โ                  โ
โ estadoCuenta     โ
โ = 'validado'     โ
โโโโโโโโโโฌโโโโโโโโโโ
         โ
         v
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โ ยกVerificaciรณn exitosa!                โ
โ                                           โ
โ  Redirigiendo a login en 2 segundos...   โ
โโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
           โ
           โ navigate('/login')
           v
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  /login                                   โ
โ                                           โ
โ  Mensaje: "Cuenta verificada.            โ
โ           Ya puedes iniciar sesiรณn."     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

                    FLUJOS ALTERNATIVOS

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

1. REENVIAR CรDIGO
   
   [Reenviar cรณdigo] โโโบ VerificationService genera nuevo cรณdigo
                         โโโบ Vuelve a pantalla de ingreso
                         โโโบ Usuario ingresa nuevo cรณdigo

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

2. CAMBIAR MรTODO

   [Cambiar mรฉtodo] โโโบ Vuelve a pantalla de selecciรณn
                    โโโบ Usuario elige otro mรฉtodo
                    โโโบ Nuevo cรณdigo generado

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

3. CรDIGO EXPIRADO

   Ingresa cรณdigo despuรฉs de 10 min
   โโโบ Error: "El cรณdigo ha expirado"
   โโโบ [Reenviar cรณdigo]

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

4. OMITIR VERIFICACIรN

   [Verificar mรกs tarde] โโโบ navigate('/login')
                         โโโบ estadoCuenta = 'pendiente'
                         โโโบ Puede verificar despuรฉs

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

                    PERSISTENCIA DE DATOS

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  localStorage                                                 โ
โ                                                               โ
โ  alkosto_users: [                                            โ
โ    {                                                          โ
โ      id: "user_1698765432",                                  โ
โ      email: "prueba@test.com",                               โ
โ      phone: "3001234567",                                    โ
โ      emailVerified: true,      โโโโ Actualizado             โ
โ      phoneVerified: false,                                   โ
โ      estadoCuenta: "validado"  โโโโ Actualizado             โ
โ    }                                                          โ
โ  ]                                                            โ
โ                                                               โ
โ  alkosto_verification_codes: {                               โ
โ    "prueba@test.com": {                                      โ
โ      code: "543210",                                         โ
โ      type: "email",                                          โ
โ      timestamp: 1698765432000,                               โ
โ      expires: 1698766032000    โโโโ +10 minutos             โ
โ    }                                                          โ
โ  }                                                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ Diagrama de Estados

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ESTADOS DE LA CUENTA                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

     [Registro]
         โ
         v
   โโโโโโโโโโโโโ
   โ PENDIENTE โ โโโโโ emailVerified: false
   โ           โ       phoneVerified: false
   โ           โ       estadoCuenta: 'pendiente'
   โโโโโโโฌโโโโโโ
         โ
         โ Verifica Email o SMS
         v
   โโโโโโโโโโโโโ
   โ VALIDADO  โ โโโโโ emailVerified: true OR phoneVerified: true
   โ           โ       estadoCuenta: 'validado'
   โ           โ
   โโโโโโโโโโโโโ
         โ
         โ Usuario puede usar todas las funciones
         v
   [Acceso Completo]
```

## ๐ Ciclo de Vida del Cรณdigo

```
   Generaciรณn
       โ
       v
   [543210] โโโโบ Guardado en localStorage
       โ
       โ         Timestamp: T
       โ         Expira: T + 10 min
       v
   ยฟTiempo < Expiraciรณn?
       โ
       โโโโ Sร โโโบ Cรณdigo vรกlido
       โ              โ
       โ              v
       โ          ยฟCรณdigo correcto?
       โ              โ
       โ              โโโโ Sร โโโบ Verificaciรณn exitosa
       โ              โ              โ
       โ              โ              v
       โ              โ          Eliminar cรณdigo
       โ              โ
       โ              โโโโ NO โโโบ Error, reintentar
       โ
       โโโโ NO โโโบ Cรณdigo expirado
                      โ
                      v
                  Eliminar cรณdigo
                      โ
                      v
                  Solicitar reenvรญo
```

---

**Leyenda**:
- `โโโโบ` Flujo normal
- `โโโโ` Actualizaciรณn de estado
- `[Botรณn]` Acciรณn del usuario
- `โโโโโโโ` Componente o estado
- `โ     โ` Contenido
- `โโโโโโโ` Fin de componente
